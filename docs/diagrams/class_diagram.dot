digraph ClassDiagram {
    // Layout settings
    rankdir=TB;
    nodesep=0.5;
    ranksep=0.8;
    splines=true; // Dynamic curved lines
    
    // Default Font Settings
    node [fontname="Helvetica", fontsize=10, shape=plain]; // 'plain' shape is key for HTML labels
    edge [fontname="Helvetica", fontsize=9, color="#555555"];

    // ==========================================
    // ENUMERATIONS
    // ==========================================
    // Orange/Yellowish header for Enums
    RoleEnum [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#FFCC80"><B>«enumeration»<BR/>RoleEnum</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">MAHASISWA<BR/>SARPRAS<BR/>SECURITY<BR/>ADMIN</TD></TR>
    </TABLE>>];

    JenisOrganisasiEnum [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#FFCC80"><B>«enumeration»<BR/>JenisOrganisasiEnum</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">ORMAWA<BR/>UKM</TD></TR>
    </TABLE>>];

    PeminjamanStatusEnum [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#FFCC80"><B>«enumeration»<BR/>PeminjamanStatusEnum</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">PENDING<BR/>APPROVED<BR/>REJECTED<BR/>ONGOING<BR/>FINISHED<BR/>CANCELLED</TD></TR>
    </TABLE>>];

    KehadiranStatusEnum [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#FFCC80"><B>«enumeration»<BR/>KehadiranStatusEnum</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">HADIR<BR/>TIDAK_HADIR<BR/>BATAL</TD></TR>
    </TABLE>>];

    // ==========================================
    // ENTITY MODELS
    // ==========================================
    // Blue header for Classes
    User [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>User</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeUser: string<BR/>
            + Nama: string<BR/>
            + Email: string<BR/>
            - PasswordHash: string<BR/>
            + Role: RoleEnum<BR/>
            + NoHP: string<BR/>
            + OrganisasiKode: string<BR/>
            + CreatedAt: time.Time
        </TD></TR>
    </TABLE>>];

    Organisasi [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>Organisasi</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeOrganisasi: string<BR/>
            + NamaOrganisasi: string<BR/>
            + JenisOrganisasi: JenisOrganisasiEnum<BR/>
            + Kontak: string<BR/>
            + CreatedAt: time.Time
        </TD></TR>
    </TABLE>>];

    Ruangan [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>Ruangan</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeRuangan: string<BR/>
            + NamaRuangan: string<BR/>
            + Lokasi: string<BR/>
            + Kapasitas: int<BR/>
            + Deskripsi: string
        </TD></TR>
    </TABLE>>];

    Barang [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>Barang</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeBarang: string<BR/>
            + NamaBarang: string<BR/>
            + Deskripsi: string<BR/>
            + JumlahTotal: int<BR/>
            + RuanganKode: string
        </TD></TR>
    </TABLE>>];

    Kegiatan [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>Kegiatan</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeKegiatan: string<BR/>
            + NamaKegiatan: string<BR/>
            + Deskripsi: string<BR/>
            + TanggalMulai: time.Time<BR/>
            + TanggalSelesai: time.Time<BR/>
            + OrganisasiKode: string<BR/>
            + CreatedAt: time.Time<BR/>
            + UpdatedAt: time.Time
        </TD></TR>
    </TABLE>>];

    Peminjaman [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>Peminjaman</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodePeminjaman: string<BR/>
            + KodeUser: string<BR/>
            + KodeRuangan: string<BR/>
            + KodeKegiatan: string<BR/>
            + TanggalMulai: time.Time<BR/>
            + TanggalSelesai: time.Time<BR/>
            + Status: PeminjamanStatusEnum<BR/>
            + PathSuratDigital: string<BR/>
            + VerifiedBy: string<BR/>
            + VerifiedAt: time.Time<BR/>
            + CatatanVerifikasi: string<BR/>
            + CreatedAt: time.Time<BR/>
            + UpdatedAt: time.Time
        </TD></TR>
    </TABLE>>];

    PeminjamanBarangDetail [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>PeminjamanBarangDetail</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodePeminjamanBarang: string<BR/>
            + KodeBarang: string<BR/>
            + Jumlah: int
        </TD></TR>
    </TABLE>>];

    KehadiranPeminjam [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>KehadiranPeminjam</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeKehadiran: string<BR/>
            + KodePeminjaman: string<BR/>
            + StatusKehadiran: KehadiranStatusEnum<BR/>
            + WaktuKonfirmasi: time.Time<BR/>
            + Keterangan: string<BR/>
            + DiverifikasiOleh: string<BR/>
            + CreatedAt: time.Time
        </TD></TR>
    </TABLE>>];

    Mailbox [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>Mailbox</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeMailbox: string<BR/>
            + KodeUser: string<BR/>
            + KodePeminjaman: string<BR/>
            + JenisPesan: string<BR/>
            + CreatedAt: time.Time
        </TD></TR>
    </TABLE>>];

    LogAktivitas [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#B3E5FC"><B>LogAktivitas</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + KodeLog: string<BR/>
            + KodeUser: string<BR/>
            + KodePeminjaman: string<BR/>
            + Aksi: string<BR/>
            + Keterangan: string<BR/>
            + Waktu: time.Time
        </TD></TR>
    </TABLE>>];

    // ==========================================
    // REPOSITORIES (Simplified to save space, but styled)
    // ==========================================
    // Yellow/Cream header
    UserRepository [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#FFF9C4"><B>UserRepository</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + Create()<BR/>
            + GetByEmail()<BR/>
            + GetByID()
        </TD></TR>
    </TABLE>>];
    
    // ... Other Repositories simplified for visual clarity but can be expanded
    PeminjamanRepository [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#FFF9C4"><B>PeminjamanRepository</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + Create()<BR/>
            + GetByID()<BR/>
            + GetPending()<BR/>
            + UpdateStatus()
        </TD></TR>
    </TABLE>>];

    // ==========================================
    // SERVICES (Greenish header)
    // ==========================================
    AuthService [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#C8E6C9"><B>AuthService</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + Login()<BR/>
            + Register()
        </TD></TR>
    </TABLE>>];

    PeminjamanService [label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
        <TR><TD BGCOLOR="#C8E6C9"><B>PeminjamanService</B></TD></TR>
        <TR><TD ALIGN="LEFT" BALIGN="LEFT">
            + CreatePeminjaman()<BR/>
            + VerifikasiPeminjaman()<BR/>
            + CancelPeminjaman()
        </TD></TR>
    </TABLE>>];

    // ==========================================
    // RELATIONSHIPS
    // ==========================================
    
    // User Relationships
    User -> RoleEnum [arrowhead=none];
    User -> Organisasi [label="0..1", style=dashed, arrowhead=vee];
    
    // Organisasi
    Organisasi -> JenisOrganisasiEnum [arrowhead=none];
    
    // Barang Relationships
    Barang -> Ruangan [label="0..1", arrowhead=vee];
    
    // Kegiatan
    Kegiatan -> Organisasi [label="1", arrowhead=vee];
    
    // Peminjaman Relationships
    Peminjaman -> User [label="peminjam", taillabel="0..*", headlabel="1", arrowhead=vee];
    Peminjaman -> PeminjamanStatusEnum [arrowhead=none];
    Peminjaman -> Ruangan [label="0..1", arrowhead=vee];
    Peminjaman -> Kegiatan [label="0..1", arrowhead=vee];
    
    // Detail Item Peminjaman (Composition/Aggregation)
    // In Graphviz/Dot 'diamond' on tail is a bit tricky with direction, we use 'odiamond' (open diamond) or 'diamond' (filled)
    // Logic: Peminjaman HAS BarangDetail
    Peminjaman -> PeminjamanBarangDetail [dir=back, arrowtail=diamond, label="1"];
    
    PeminjamanBarangDetail -> Barang [label="1", arrowhead=vee];

    // Kehadiran
    KehadiranPeminjam -> Peminjaman [label="1", arrowhead=vee];
    KehadiranPeminjam -> KehadiranStatusEnum [arrowhead=none];
    KehadiranPeminjam -> User [label="verifier", style=dashed];

    // Mailbox
    Mailbox -> User [label="receiver", arrowhead=vee];
    
    // Log
    LogAktivitas -> User [label="actor", arrowhead=vee];

    // Layer Dependencies
    // Explicitly setting style=solid to override any defaults and ensure Association relationship
    PeminjamanService -> PeminjamanRepository [style=solid, arrowhead=open, label="owns"];
    
    // Invisible edge for layout enforcement
    PeminjamanService -> AuthService [style=invis]; 
    
    AuthService -> UserRepository [style=solid, arrowhead=open, label="owns"];

    // Usage Dependencies (Service/Repo USES Entity)
    // Clarifying that PeminjamanService and Repository operate on the Peminjaman entity
    PeminjamanRepository -> Peminjaman [style=dashed, arrowhead=vee, label="uses"];
    PeminjamanService -> Peminjaman [style=dashed, arrowhead=vee, label="uses"];
    
    // Auth & User Usage
    UserRepository -> User [style=dashed, arrowhead=vee, label="uses"];
    AuthService -> User [style=dashed, arrowhead=vee, label="uses"];
}
